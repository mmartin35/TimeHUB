{% extends 'base.html' %}

{% block title %}Pointer{% endblock %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'pointer/css/pointer.css' %}">
{% endblock %}
{% block script %}
{% endblock %}

{% block content %}
<div class="alert alert-secondary" id="table-container" style="background-color: transparent">
    {% if show_days_off_alert %}
    <div class="alert alert-danger" role="alert">
        Votre stage se termine bientôt ! Utilisez vos jours de congés avant la fin de celui-ci.
    </div>
    {% endif %}
    <div class="row">
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">Status</th>
                    {% if status %}
                    <th scope="col">Active</th>
                    {% else %}
                    <th scope="col">Inactive</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th scope="row">T1</th>
                    {% if timer.t1 %}
                    <td>{{ timer.t1 }}</td>
                    {% else %}
                    <td>None</td>
                    {% endif %}
                </tr>
                <tr>
                    <th scope="row">T2</th>
                    {% if timer.t2 %}
                    <td>{{ timer.t2 }}</td>
                    {% else %}
                    <td>None</td>
                    {% endif %}
                </tr>
                {% if not timer.half_day %}
                <tr>
                    <th scope="row">T3</th>
                    {% if timer.t3 %}
                    <td>{{ timer.t3 }}</td>
                    {% else %}
                    <td>None</td>
                    {% endif %}
                </tr>
                <tr>
                    <th scope="row">T4</th>
                    {% if timer.t4 %}
                    <td>{{ timer.t4 }}</td>
                    {% else %}
                    <td>None</td>
                    {% endif %}
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    <div class="row">
        <div class="col">
            <div class="btn-container">
                <form method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="pointer">
                    <button type="submit" class="btn btn-light">Pointer</button>
                </form>
            </div>
        </div>
        <div class="col">
            <div class="btn-container">
                <form method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="service">
                    <button type="submit" class="btn btn-light">
                    {% if not service_state %}
                    Départ en service
                    {% else %}
                    Retour de service
                    {% endif %}
                    </button>
                </form>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <button class="btn btn-outline-light" type="button" data-bs-toggle="collapse" data-bs-target="#RequestSubmit" aria-expanded="false" aria-controls="collapseExample">
                Demander correction
            </button>
        </div>
        <div class="col">
            <button class="btn btn-outline-light" type="button" data-bs-toggle="collapse" data-bs-target="#RequestDisplay" aria-expanded="false" aria-controls="collapseExample">
                Afficher demandes de correction
            </button>
        </div>
    </div>
    <button class="btn btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#timers" aria-expanded="false" aria-controls="collapseExample" style="margin-top: 10px">
        Plus d'informations
    </button>
    <div class="collapse" id="timers">
        <div class="row" style="margin-top: 10px">
            <div class="col">
                <b>Heures de ce mois-ci: </b><br>
                <b>Heures totales de la semaine: </b>
            </div>
            <div class="col">
                {{ intern_current_month_worktime|floatformat:2 }}<br>
                {{ intern_current_week_worktime|floatformat:2 }}
            </div>
        </div>
        <div class="row">
            <table class="table table" style="color: white">
                <thead>
                    <tr>
                        <th>Semaine {{ week }}</th>
                        <th>P1</th>
                        <th>P2</th>
                        <th>P3</th>
                        <th>P4</th>
                        <th>Temps de travail</th>
                    </tr>
                </thead>
                <tbody>
                    {% for day in intern_last_week_data %}
                    <tr>
                        {% if day.date.weekday == 0 %}
                        <td>Lundi {{ day.date }}</td>
                        {% elif day.date.weekday == 1 %}
                        <td>Mardi {{ day.date }}</td>
                        {% elif day.date.weekday == 2 %}
                        <td>Mercredi {{ day.date }}</td>
                        {% elif day.date.weekday == 3 %}
                        <td>Jeudi {{ day.date }}</td>
                        {% elif day.date.weekday == 4 %}
                        <td>Vendredi {{ day.date }}</td>
                        {% else %}
                        <td>Weekend {{ day.date }}</td>
                        {% endif %}
                        <td>{{ day.t1 }}</td>
                        <td>{{ day.t2 }}</td>
                        <td>{{ day.t3 }}</td>
                        <td>{{ day.t4 }}</td>
                        <td>{{ day.worktime|floatformat:2 }}h
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="collapse" id="RequestSubmit">
    <div class="card card-body">
        <h3 style="text-align: center; margin-top: 30px; margin-bottom: 30px">Demande de correction de pointage</h3>
        <hr>
        <form method="POST">
            {% csrf_token %}
            <div class="row">
                <div class="col">
                    <label for="date">Date</label>
                    <input type="date" class="form-control" id="date" name="date" required>
                    <label for="comment">Commentaire</label>
                    <input type="text" class="form-control" id="comment" name="comment" required>
                </div>
                <div class="col">
                    <label for="t1">P1</label>
                    <input type="time" class="form-control" id="t1" name="t1" required>
                    <label for="t2">P2</label>
                    <input type="time" class="form-control" id="t2" name="t2" required>
                    <label for="t3">P3</label>
                    <input type="time" class="form-control" id="t3" name="t3" required>
                    <label for="t4">P4</label>
                    <input type="time" class="form-control" id="t4" name="t4" required>
                </div>
            </div>
            <button type="submit" class="btn btn-outline-secondary" style="margin-top: 20px">Soumettre la demande</button>
        </form>
    </div>
</div>
<div class="collapse" id="RequestDisplay">
    <div class="card card-body">
        <div class="alert alert-secondary" style="background-color: transparent; color: white; margin-top: 30px">
            <h5 style="text-align: center; margin-top: 30px; margin-bottom: 30px">Corrections soumises</h5>
            <hr>
            {% for requested in request_list %}
            <hr>
            <div class="row">
                <div class="col" style="text-align: center;">
                    <p>Date: {{ requested.date }}</p>
                    <p>Description: {{ requested.comment }}</p>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p>P1:</p>
                    <p>P2:</p>
                    <p>P3:</p>
                    <p>P4:</p>
                </div>
                <div class="col">
                    <p>{{ requested.original_t1 }}</p>
                    <p>{{ requested.original_t2 }}</p>
                    <p>{{ requested.original_t3 }}</p>
                    <p>{{ requested.original_t4 }}</p>
                </div>
                <div class="col">
                    <p>{{ requested.altered_t1 }}</p>
                    <p>{{ requested.altered_t2 }}</p>
                    <p>{{ requested.altered_t3 }}</p>
                    <p>{{ requested.altered_t4 }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
